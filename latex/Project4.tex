\documentclass[11pt, a4paper]{article}

\usepackage[T1]{fontenc}	
\usepackage[utf8]{inputenc}
\usepackage[norsk]{babel}	
\usepackage{graphicx}		
\usepackage{enumerate}		
\usepackage{mathtools}		
\usepackage{listings}		
\usepackage{pdfpages}									%
%\usepackage{tikz}			
\usepackage{multirow}		
\usepackage{cite}			
%\usepackage{algorithm}		
%\usepackage{hyperref}
\usepackage{url}
\usepackage{braket}			

\setcounter{tocdepth}{3}

\newcommand{\db}{\text{dB}}
\newcommand{\pdiff}[2]{\frac{\partial #1}{\partial #2}}

\lstset{language = C++, commentstyle=\textcolor[rgb]{0.00,0.50,0.00}, keepspaces=true, columns=flexible, basicstyle=\footnotesize, keywordstyle=\color{blue}, showstringspaces=false, inputencoding=ansinew}

%For Ã¥ nummerere bare ligninger det refereres til
\mathtoolsset{showonlyrefs}


\author{Eivind Brox}

\title{Project 4}
\pagenumbering{roman}
\setcounter{page}{0}		
\date{\today}
\begin{document}
\maketitle
\thispagestyle{empty}
\clearpage	

\section{Abstract}



\clearpage
\pagestyle{headings}		
\tableofcontents		
\clearpage
\pagenumbering{arabic}		

\section{Introduction}
\clearpage
\section{Method}
\subsection{The Ising Model and Thermodynamical Properties}
For the Ising model in two dimensions, without the presence of a external magnetic field, and with a prefered axis of magnetization for the material, we have that the energy is
\begin{gather}
E = -J\sum\limits_{\braket{kl}}^N s_ks_l
\label{eq:main_energy}
\end{gather}
where $N$ is the total number of spins and the symbol $\braket{kl}$ indicates that we only sum over the nearest neighbors. This is assumning that the magnetic dipoles only interacts with its nearest neighbors. We also have to be aware of the fact that we should not count the interactions between two spins twice. 

We have to consider what to do with the endpoints. The most natural choice is to use periodic boundary conditions. That is to say that when we consider an endpoint the neighbor or neighbors that do not really exist, are set to the value at the opposite endpoint.

We have that the probability for the system being in a given microstate $i$, is 
\begin{gather}
P_i = \frac{e^{-\beta E_i}}{Z}
\end{gather}
where $\beta=(k_BT)^{-1}$, $k_B$ is Boltzmann's constant and $Z$ is the partition function determined by
\begin{gather}
Z = \sum\limits_i e^{-\beta E_i}
\label{eq:main_partition}
\end{gather}

We can determine thermodynamical properties from the partition function. 
\begin{gather}
\braket{E} = -\pdiff{\ln Z}{\beta}
\label{eq:energy}
\end{gather}
where $\braket{E}$ is the expectation value of the energy, which is to say the most probable energy when the system has reached equilibrium. 

The magnetic moment is defined as
\begin{gather}
{\cal M}_i = \sum\limits_{j=1}^N s_j
\end{gather}
and the expectation value of the magnetic moment is defined as
\begin{gather}
\braket{\cal M} = \frac{1}{Z}\sum\limits_{i}{\cal M}_ie^{-\beta E_i}
\end{gather}

The susceptibility is defined as 
\begin{gather}
\chi = \frac{\braket{{\cal M}^2}-\braket{\cal M}^2}{k_BT}
\label{eq:main_suscept}
\end{gather}

\subsubsection{An Analytical Example}
When developing models for numerical calculations it is always a good idea to have an analytical solution to test the model against. Here we choose to consider the two dimensional rectangular system with four spins. We can find analytical solutions with relatively few calculations. 

The energy in Eq. \eqref{eq:main_energy} reduces to 
\begin{gather}
E = -J(s_1s_2 + s_1s_3 + s_2s_1  + s_3s_1 + s_2s_4 + s_3s_4 + s_4s_2 + s_4s_3)
\end{gather}
when we use periodic boundary conditions.

As an example we get the following energies for some spin configurations.

\begin{gather}
\begin{aligned}
\left.\begin{array}{ll}
	\uparrow & \uparrow\\
	\uparrow & \uparrow
\end{array}\right\}
\quad E &= -J(1\cdot1 + \dots + 1\cdot1) = -8J
\\
\left.\begin{array}{ll}
	\uparrow & \uparrow\\
	\downarrow & \uparrow
\end{array}\right\}
\quad E &= -J(-1\cdot1 + \cdot + -1\cdot1 +1\cdot1 + \cdot + 1\cdot1) = 0
\\
\left.\begin{array}{ll}
	\uparrow & \downarrow\\
	\downarrow & \uparrow
\end{array}\right\}
\quad E &= -J(-1\cdot1 + -1\cdot1 + 1\cdot-1 + 1\cdot-1 \\
&+1\cdot-1 + 1\cdot-1 + -1\cdot1 + -1\cdot1) = 8J
\end{aligned}
\end{gather}

The energies are as given in table \ref{tab:energy}

\begin{table}[!ht]
\centering
\begin{tabular}{c|c|c|c}
\# spins up & Multiplicity & Energy $(J)$ & Net Magnetic Moment \\
\hline
4 & 1 & -8 & 4\\
3 & 4 & 0 & 2\\
2 & 4 & 0 & 0\\
2 & 2 & 8 & 0\\
1 & 4 & 0 & -2\\
0 & 1 & -8 & -4
\end{tabular}
\label{tab:energy}
\end{table}

We can rewrite the partition function from Eq. \eqref{eq:main_partition} as
\begin{gather}
Z = \sum\limits_E \Omega(E)e^{-\beta E}
\end{gather} 


where we sum over the different possible energies that may appear for the system, and $\Omega(E)$ is the number of configurations that gives the energy $E$. For the $2 \times 2$ system this now reduces to 
\begin{gather}
\begin{aligned}
Z &= e^{8\beta J} + 4 e^{-0\cdot\beta J} + 4e^{-0\cdot\beta J} + 2e^{-8\beta J} + 4e^{-0\cdot\beta J} + e^{8\beta J}\\
&= 2e^{8\beta J} + 2e^{-8\beta J} + 12 = 2(e^{8\beta J} + e^{-8\beta J}) + 12\\
&= 4\cosh(8\beta J) + 12
\end{aligned}
\end{gather}
where we have used that $(e^{8\beta J} + e^{-8\beta J}) = 2\cosh(8\beta J)$.

Then we may find the expected energy of the system from Eq. \eqref{eq:energy}
\begin{gather}
\braket{E} = -\frac{1}{Z}\pdiff{Z}{\beta} = -\frac{1}{4\cosh (8J\beta) + 12}\cdot\pdiff{}{\beta}\left(4\cosh (8J\beta) + 12\right)\\
 =  -\frac{32J\sinh(8J\beta)}{4\cosh (8J\beta) + 12}
 = -\frac{8J\sinh(8J\beta)}{\cosh (8J\beta) + 3}
\end{gather}
Now, we are also able to find the heat capacity
\begin{gather}
C_V = \pdiff{\braket{E}}{T} = \pdiff{\braket{E}}{\beta}\pdiff{\beta}{T} = -\frac{1}{kT^2}\pdiff{\braket{E}}{\beta} = \frac{8J}{kT^2} \pdiff{}{\beta}\left[\frac{\sinh(8J\beta)}{\cosh (8J\beta) + 3}\right]\\
= \frac{(8J)^2}{kT^2}\left[\frac{1+3\cosh(8J\beta)}{(\cosh (8J\beta) + 3)^2}\right]
\end{gather}

We have that the mean magnetic moment is
\begin{gather}
\begin{aligned}
\braket{|\cal M|} &= \frac{1}{Z}\sum\limits_{i}{|\cal M}_i|e^{-\beta E_i} = \frac{1}{Z}\sum\limits_{E}\Omega(E)|{\cal M}(E)|e^{-\beta E}\\
 &= 4e^{8\beta J} + 4\cdot2e^0 + 4\cdot2e^0 + 4e^{8\beta J} = 8(e^{8\beta J} +2)
 \end{aligned}
\end{gather}
and the susceptibility, which we have from Eq. \eqref{eq:main_suscept} is
\begin{gather}
\begin{aligned}
\chi &= \frac{1}{k_BT}\sum\limits_E \Omega(E){\cal M}^2e^{-\beta E}\\
 &= \frac{1}{k_BT}(4^2e^{8\beta J} + 4\cdot2^2 + 4\cdot(-2)^2 + (-4)^2e^{8\beta J}) = \frac{32}{k_BT}(e^{8\beta J}+1)
 \end{aligned}
\end{gather}
since $\braket{\cal M} = 0$.

% We may also compare with Lars Onsager's analytical results for the two dimensional Ising model when the number of spins goes to infinity.

\subsection{Monte Carlo Simulation}
Determining the probabilities for all the different microstates in a system consisting of a fair amount of spins takes a lot of time. The number of microstates goes as $2^N$ where $N$ is the number of spins in the system. Analyzing all microstates of a system becomes computationally heavy, even for a fairly small number of spins. Just passing about 100 spins, makes the calculations impossible even with modern computers. 

The idea to overcome this problem is to sample just a random selection of the microstates, and hope that these represent the system fairly well. We calculate the Boltzmann constant for each of these states and use them to calculate the thermodynamical properties of interest. The problem is of course that we will only sample a really small selection of the micro states, and will probably never encounter those that actually are important. 

The strategy will thus be to utilize the Boltzmann constants to choose the subset of states to be randomly generated. An algorithm which does exactly this is the \textit{Metropolis algorithm}. The outline of the algorithm is as follows. Initialize the system of spins, either randomly or in some way that seems beneficial to e.g. the temperature. Select a spin at random and consider the change in energy when flipping the spin. If the energy decreases, then flip the spin. If the energy increases, then flip the spin with a probability of $e^{-(E_2-E_1)\beta}$. Move on to a new random spin and repeat the same procedure. Do this for so many times that each spin theoretically can have been considered for many times.



\clearpage
\section{Results}


\clearpage
\section{Discussion}

\clearpage
\section{Conclusion}
\appendix


% \lstinputlisting{filsti_til_din_programkodefil}


\end{document}